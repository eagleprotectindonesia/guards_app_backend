# Eagle Protect External API Documentation

The Eagle Protect application exposes an external API to allow third-party systems and services to access organization data such as employees, sites, shifts, and their respective attendances securely.

## 1. Viewing the API Documentation

The full OpenAPI (Swagger) documentation is available directly within the application. It provides an interactive interface to explore all available endpoints, required parameters, and response schemas.

**To access the public API documentation:**
1. Start the web application (e.g., `npm run dev` or accessing your production domain).
2. Navigate your browser to: `http://localhost:3000/api/external/docs` (replace `http://localhost:3000` with your actual domain if running in production).

This page will render the Swagger UI, reading directly from the live `openapi.json` specification generated by the server.

## 2. Authentication (Obtaining an API Key)

All external API endpoints are secured and require a valid API Key to be passed in the headers.

**Header Format:**
```http
X-API-KEY: your_generated_api_key_here
```

### How to Generate an API Key

API Keys are securely generated and managed via the Admin Dashboard. 

1. Log in to the Eagle Protect **Admin Dashboard** with administrative privileges.
2. In the side navigation, go to **System** -> **API Keys** (URL path: `/admin/system/api-keys`).
3. Click on the button to **Create New API Key**.
4. Enter a descriptive name for the key (e.g., "ERP Integration Key") and confirm.
5. **Important:** The raw API Key will be displayed on the screen **only once**. Make sure to copy it immediately and store it securely in your external system's environment variables or secrets manager. For security reasons, the system only stores a hashed version of the key.
6. You can temporarily disable or permanently delete API Keys from this same dashboard if they are ever compromised or no longer needed.

## 3. Important Notes on Grouped Attendance API Data

When using the `/api/external/v1/attendance/grouped` endpoint:

- **Streaming Response:** To efficiently handle potentially massive datasets without crashing the system's memory, this endpoint utilizes a chunk-encoded `ReadableStream` to send the JSON response. Your consuming application can parse it simultaneously as a stream for highest efficiency or wait for the entire response to finish and parse it as a standard JSON object.
- **Date Constraints:** The `start_date` and `end_date` parameters accept ISO 8601 strings. If you are querying for all attendances in the system (i.e. `employee_id` is omitted), the maximum allowed span between these two dates is **1 week (7 days)**. If an `employee_id` is provided, you can query across any date range.
- **Defaults:** If `end_date` is omitted, it defaults to the exact time of the API request. If `start_date` is omitted, it defaults to exactly 7 days prior to `end_date`.
